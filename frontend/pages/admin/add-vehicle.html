<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Vehicle - Prestigio Motors Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: '#d4af37',
                        'gold-light': '#e6c757',
                        'gold-dark': '#b8941f'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-black text-white min-h-screen">
    <div class="container mx-auto px-6 py-8">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-gold mb-2">Add New Vehicle</h1>
                <p class="text-gray-400">Add a new vehicle to your inventory</p>
            </div>
            <button onclick="window.history.back()" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-lg transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>Back
            </button>
        </div>

        <!-- Form Container -->
        <div class="bg-gray-900 rounded-lg p-8">
            <form id="addVehicleForm" onsubmit="submitVehicle(event)" class="space-y-6">
                <!-- Basic Information -->
                <div class="border-b border-gray-700 pb-6">
                    <h2 class="text-xl font-semibold text-gold mb-4">Basic Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="vehicleName" class="block text-sm font-medium mb-2">Vehicle Name *</label>
                            <input type="text" id="vehicleName" name="vehicleName" required
                                   class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent"
                                   placeholder="e.g., 488 GTB, Camry, Model S">
                        </div>
                        <div>
                            <label for="brand" class="block text-sm font-medium mb-2">Brand *</label>
                            <select id="brand" name="brand" required
                                    class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent">
                                <option value="">Select Brand</option>
                                <option value="Ferrari">Ferrari</option>
                                <option value="Lamborghini">Lamborghini</option>
                                <option value="Porsche">Porsche</option>
                                <option value="McLaren">McLaren</option>
                                <option value="Aston Martin">Aston Martin</option>
                                <option value="Bentley">Bentley</option>
                                <option value="Rolls-Royce">Rolls-Royce</option>
                                <option value="BMW">BMW</option>
                                <option value="Mercedes-Benz">Mercedes-Benz</option>
                                <option value="Audi">Audi</option>
                                <option value="Toyota">Toyota</option>
                                <option value="Honda">Honda</option>
                                <option value="Nissan">Nissan</option>
                                <option value="Ford">Ford</option>
                                <option value="Chevrolet">Chevrolet</option>
                                <option value="Tesla">Tesla</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label for="customBrand" class="block text-sm font-medium mb-2">Custom Brand</label>
                            <input type="text" id="customBrand" name="customBrand"
                                   class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent"
                                   placeholder="Enter custom brand name" style="display: none;">
                        </div>
                        <div>
                            <label for="category" class="block text-sm font-medium mb-2">Category *</label>
                            <select id="category" name="category" required
                                    class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent">
                                <option value="">Select Category</option>
                                <option value="luxury">Exotic/Luxury</option>
                                <option value="regular">Signature/Regular</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Pricing and Details -->
                <div class="border-b border-gray-700 pb-6">
                    <h2 class="text-xl font-semibold text-gold mb-4">Pricing & Details</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label for="price" class="block text-sm font-medium mb-2">Price *</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">$</span>
                                <input type="number" id="price" name="price" required min="0" step="1000"
                                       class="w-full bg-gray-800 border border-gray-700 rounded-lg pl-8 pr-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent"
                                       placeholder="0">
                            </div>
                        </div>
                        <div>
                            <label for="year" class="block text-sm font-medium mb-2">Year *</label>
                            <input type="number" id="year" name="year" required min="1900" max="2025"
                                   class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent"
                                   placeholder="2023">
                        </div>
                        <div>
                            <label for="mileage" class="block text-sm font-medium mb-2">Mileage</label>
                            <input type="number" id="mileage" name="mileage" min="0"
                                   class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent"
                                   placeholder="0">
                        </div>
                    </div>
                </div>

                <!-- Vehicle Information -->
                <div class="border-b border-gray-700 pb-6">
                    <h2 class="text-xl font-semibold text-gold mb-4">Vehicle Information</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="description" class="block text-sm font-medium mb-2">Description *</label>
                            <textarea id="description" name="description" required rows="4"
                                      class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent"
                                      placeholder="Enter detailed description including engine specs, features, condition, etc."></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="engine" class="block text-sm font-medium mb-2">Engine</label>
                                <input type="text" id="engine" name="engine"
                                       class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent"
                                       placeholder="e.g., 3.9L V8 Twin-Turbo">
                            </div>
                            <div>
                                <label for="horsepower" class="block text-sm font-medium mb-2">Horsepower</label>
                                <input type="number" id="horsepower" name="horsepower" min="0"
                                       class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent"
                                       placeholder="661">
                            </div>
                            <div>
                                <label for="transmission" class="block text-sm font-medium mb-2">Transmission</label>
                                <select id="transmission" name="transmission"
                                        class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent">
                                    <option value="">Select Transmission</option>
                                    <option value="Manual">Manual</option>
                                    <option value="Automatic">Automatic</option>
                                    <option value="CVT">CVT</option>
                                    <option value="Dual-Clutch">Dual-Clutch</option>
                                </select>
                            </div>
                            <div>
                                <label for="fuelType" class="block text-sm font-medium mb-2">Fuel Type</label>
                                <select id="fuelType" name="fuelType"
                                        class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent">
                                    <option value="">Select Fuel Type</option>
                                    <option value="Gasoline">Gasoline</option>
                                    <option value="Diesel">Diesel</option>
                                    <option value="Electric">Electric</option>
                                    <option value="Hybrid">Hybrid</option>
                                    <option value="Plug-in Hybrid">Plug-in Hybrid</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Images -->
                <div class="border-b border-gray-700 pb-6">
                    <h2 class="text-xl font-semibold text-gold mb-4">Images</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="mainImage" class="block text-sm font-medium mb-2">Main Image URL *</label>
                            <input type="url" id="mainImage" name="mainImage" required
                                   class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent"
                                   placeholder="https://example.com/image.jpg">
                        </div>
                        <div>
                            <label for="brandLogo" class="block text-sm font-medium mb-2">Brand Logo URL</label>
                            <input type="url" id="brandLogo" name="brandLogo"
                                   class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent"
                                   placeholder="https://example.com/logo.png">
                        </div>
                        <div>
                            <label for="additionalImages" class="block text-sm font-medium mb-2">Additional Images (comma-separated URLs)</label>
                            <textarea id="additionalImages" name="additionalImages" rows="3"
                                      class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent"
                                      placeholder="https://example.com/image2.jpg, https://example.com/image3.jpg"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Status and Availability -->
                <div class="pb-6">
                    <h2 class="text-xl font-semibold text-gold mb-4">Status & Availability</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="status" class="block text-sm font-medium mb-2">Status *</label>
                            <select id="status" name="status" required
                                    class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent">
                                <option value="available">Available</option>
                                <option value="reserved">Reserved</option>
                                <option value="sold">Sold</option>
                                <option value="maintenance">Under Maintenance</option>
                            </select>
                        </div>
                        <div>
                            <label for="location" class="block text-sm font-medium mb-2">Location</label>
                            <input type="text" id="location" name="location"
                                   class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-gold focus:border-transparent"
                                   placeholder="Showroom, Warehouse, etc.">
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="flex justify-end gap-4 pt-6 border-t border-gray-700">
                    <button type="button" onclick="resetForm()" class="bg-gray-700 hover:bg-gray-600 px-6 py-3 rounded-lg transition-colors">
                        <i class="fas fa-undo mr-2"></i>Reset Form
                    </button>
                    <button type="button" onclick="saveDraft()" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg transition-colors">
                        <i class="fas fa-save mr-2"></i>Save Draft
                    </button>
                    <button type="submit" class="bg-gold hover:bg-gold-dark text-black px-6 py-3 rounded-lg font-semibold transition-colors">
                        <i class="fas fa-plus mr-2"></i>Add Vehicle
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-gray-900 rounded-lg p-8 max-w-md w-full mx-4">
            <div class="text-center">
                <i class="fas fa-check-circle text-green-500 text-4xl mb-4"></i>
                <h3 class="text-xl font-bold mb-2">Vehicle Added Successfully!</h3>
                <p class="text-gray-400 mb-6">The vehicle has been added to your inventory.</p>
                <div class="flex justify-center gap-4">
                    <button onclick="addAnother()" class="bg-gold hover:bg-gold-dark text-black px-6 py-2 rounded-lg font-semibold transition-colors">
                        Add Another
                    </button>
                    <button onclick="viewInventory()" class="bg-gray-700 hover:bg-gray-600 px-6 py-2 rounded-lg transition-colors">
                        View Inventory
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';

        // Handle brand selection
        document.getElementById('brand').addEventListener('change', function() {
            const customBrandInput = document.getElementById('customBrand');
            if (this.value === 'Other') {
                customBrandInput.style.display = 'block';
                customBrandInput.required = true;
            } else {
                customBrandInput.style.display = 'none';
                customBrandInput.required = false;
                customBrandInput.value = '';
            }
        });

        // Auto-populate current year
        document.getElementById('year').value = new Date().getFullYear();

        async function submitVehicle(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const vehicleData = {};
            
            // Convert FormData to object
            for (let [key, value] of formData.entries()) {
                vehicleData[key] = value;
            }
            
            // Handle custom brand
            if (vehicleData.brand === 'Other' && vehicleData.customBrand) {
                vehicleData.brand = vehicleData.customBrand;
            }
            delete vehicleData.customBrand;
            
            // Format price
            vehicleData.price = `$${parseInt(vehicleData.price).toLocaleString()}`;
            
            // Process additional images
            if (vehicleData.additionalImages) {
                vehicleData.additionalImages = vehicleData.additionalImages.split(',').map(url => url.trim()).filter(url => url);
            }
            
            // Create the vehicle info string
            let info = vehicleData.description;
            if (vehicleData.engine) info += ` | Engine: ${vehicleData.engine}`;
            if (vehicleData.horsepower) info += ` | ${vehicleData.horsepower} HP`;
            if (vehicleData.transmission) info += ` | ${vehicleData.transmission}`;
            if (vehicleData.fuelType) info += ` | ${vehicleData.fuelType}`;
            if (vehicleData.mileage) info += ` | ${vehicleData.mileage} miles`;
            
            // Prepare final data structure
            const finalData = {
                name: vehicleData.vehicleName,
                brand: vehicleData.brand,
                category: vehicleData.category,
                price: vehicleData.price,
                image: vehicleData.mainImage,
                brandLogo: vehicleData.brandLogo,
                info: info,
                year: parseInt(vehicleData.year),
                status: vehicleData.status,
                location: vehicleData.location,
                additionalImages: vehicleData.additionalImages || [],
                isActive: true,
                specs: {
                    engine: vehicleData.engine,
                    horsepower: vehicleData.horsepower ? parseInt(vehicleData.horsepower) : null,
                    transmission: vehicleData.transmission,
                    fuelType: vehicleData.fuelType,
                    mileage: vehicleData.mileage ? parseInt(vehicleData.mileage) : 0
                }
            };
            
            try {
                showLoading(true);
                
                const response = await fetch(`${API_BASE}/admin/cars`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(finalData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    console.log('Vehicle added successfully:', data.car);
                    showLoading(false);
                    
                    if (window.opener) {
                        window.opener.postMessage({
                            type: 'VEHICLE_ADDED',
                            vehicle: data.car,
                            category: finalData.category
                        }, '*');
                    }
                    
                    localStorage.removeItem('vehicleCache');
                    localStorage.removeItem('luxuryVehicleCache');
                    localStorage.removeItem('regularVehicleCache');
                    
                    showSuccessModal();
                } else {
                    showLoading(false);
                    showNotification(data.message || 'Error adding vehicle', 'error');
                }
                
            } catch (error) {
                console.error('Error adding vehicle:', error);
                showLoading(false);
                showNotification('Error adding vehicle. Please try again.', 'error');
            }
        }

        function resetForm() {
            if (confirm('Are you sure you want to reset the form? All data will be lost.')) {
                document.getElementById('addVehicleForm').reset();
                document.getElementById('year').value = new Date().getFullYear();
                document.getElementById('customBrand').style.display = 'none';
                document.getElementById('customBrand').required = false;
            }
        }

        function saveDraft() {
            const formData = new FormData(document.getElementById('addVehicleForm'));
            const draftData = {};
            
            for (let [key, value] of formData.entries()) {
                draftData[key] = value;
            }
            
            localStorage.setItem('vehicleDraft', JSON.stringify(draftData));
            showNotification('Draft saved successfully!', 'success');
        }

        function loadDraft() {
            const draft = localStorage.getItem('vehicleDraft');
            if (draft) {
                const draftData = JSON.parse(draft);
                const form = document.getElementById('addVehicleForm');
                
                for (let [key, value] of Object.entries(draftData)) {
                    const field = form.querySelector(`[name="${key}"]`);
                    if (field) {
                        field.value = value;
                    }
                }
                
                // Trigger brand change event if needed
                if (draftData.brand === 'Other') {
                    document.getElementById('brand').dispatchEvent(new Event('change'));
                }
            }
        }

        function showSuccessModal() {
            document.getElementById('successModal').classList.remove('hidden');
            document.getElementById('successModal').classList.add('flex');
            
            // Clear draft
            localStorage.removeItem('vehicleDraft');
        }

        function addAnother() {
            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('successModal').classList.remove('flex');
            resetForm();
        }

        function viewInventory() {
            // Navigate to inventory page based on category
            const category = document.getElementById('category').value;
            if (category === 'luxury') {
                window.location.href = 'exotic-inventory.html';
            } else {
                window.location.href = 'signature-inventory.html';
            }
        }

        function showLoading(show) {
            const submitBtn = document.querySelector('button[type="submit"]');
            if (show) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Adding Vehicle...';
            } else {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-plus mr-2"></i>Add Vehicle';
            }
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 ${
                type === 'success' ? 'bg-green-600' : 'bg-red-600'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }

        // Load draft on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDraft();
        });

        // Auto-save draft every 30 seconds
        setInterval(() => {
            const form = document.getElementById('addVehicleForm');
            if (form.querySelector('input:not([value=""]), textarea:not([value=""]), select:not([value=""])')) {
                saveDraft();
            }
        }, 30000);
    </script>
</body>
</html> 